<?php/** * Egoi Mail List Builder main class**/class EgoiMailListBuilderContactForm7 {	private $egoiMailListBuilderContactForm7Data = array(		'api_key' => '',		'client_id' => ''	);		private $egoiMailListBuilderContactForm7Error = array(		"exists" => false,		"error" => "",		"description" => "",	);	private $egoiMailListBuilderContactForm7Comments = array(		"subscribe_enable" => false,		"hide_subscribe" => false,		"subscribe_enable_checkbox" => false,		"subscribe_text" => "Subscribe!",		"subscribe_list" => ""	);	private $egoiMailListBuilderContactForm7OptIn = array(		'double_opt_in' => 0	);	private $egoiMailListBuilderContactForm7ErrorCodes = array();	private $egoiMailListBuilderContactForm7WidgetText = array();	function __construct($api_key = '', $logout = false) {		require(EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_DIR.'includes/error_codes.php');		$this->egoiMailListBuilderContactForm7ErrorCodes = $errorCodes;		require(EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_DIR.'includes/widget_text.php');		$this->egoiMailListBuilderContactForm7WidgetText = $widgetText;		if(!empty($api_key)) {			$params = array(				'apikey' => $api_key, 				'plugin_key' => EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_PLUGIN_KEY);			$result = $this->connectXmlrpc('getClientData',$params);			if(is_string($result)){				if(array_key_exists((string)$result,$this->egoiMailListBuilderContactForm7ErrorCodes)) {						$this->egoiMailListBuilderContactForm7Error['exists'] = true;						$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result;						$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result];				}			}			else {				$this->egoiMailListBuilderContactForm7Data['api_key'] = $api_key;				$this->egoiMailListBuilderContactForm7Data['client_id'] = $result['CLIENTE_ID'];			}		}		else {			if(!$logout){				$params = array(					'apikey' => $this->egoiMailListBuilderContactForm7Data['api_key'], 					'plugin_key' => EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_PLUGIN_KEY);				$result = $this->connectXmlrpc('getClientData',$params);				if(is_string($result)){					if(array_key_exists((string)$result,$this->egoiMailListBuilderContactForm7ErrorCodes)) {							$this->egoiMailListBuilderContactForm7Error['exists'] = true;							$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result;							$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result];					}				}				else {					$this->egoiMailListBuilderContactForm7Data['client_id'] = $result['CLIENTE_ID'];				}			}		}	}		private function connectXmlrpc($callType, $params) {		$client = new Zend_XmlRpc_Client(EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_XMLRPC_URL);		$client->getHttpClient()->setConfig(array('timeout'=>60));		$result = $client->call($callType, array($params));		return $result;	}		public function __get($egoiMailListBuilderContactForm7Name) {        if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7Data)) {            return $this->egoiMailListBuilderContactForm7Data[$egoiMailListBuilderContactForm7Name];        }        else if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7Error)) {            return $this->egoiMailListBuilderContactForm7Error[$egoiMailListBuilderContactForm7Name];        }        else if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7WidgetText)) {            return $this->egoiMailListBuilderContactForm7WidgetText[$egoiMailListBuilderContactForm7Name];        }        else if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7Comments)) {            return $this->egoiMailListBuilderContactForm7Comments[$egoiMailListBuilderContactForm7Name];        }        else if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7OptIn)) {            return $this->egoiMailListBuilderContactForm7OptIn[$egoiMailListBuilderContactForm7Name];        }		else {			return null;		}	}		public function __set($egoiMailListBuilderContactForm7Name, $egoiMailListBuilderContactForm7Value) {		if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7Data)) {        	$this->egoiMailListBuilderContactForm7Data[$egoiMailListBuilderContactForm7Name] = $egoiMailListBuilderContactForm7Value;    	}    	else if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7Error)) {            $this->egoiMailListBuilderContactForm7Error[$egoiMailListBuilderContactForm7Name] = $egoiMailListBuilderContactForm7Value;        }        else if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7WidgetText)) {            $this->egoiMailListBuilderContactForm7WidgetText[$egoiMailListBuilderContactForm7Name] = $egoiMailListBuilderContactForm7Value;        }        else if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7Comments)) {            $this->egoiMailListBuilderContactForm7Comments[$egoiMailListBuilderContactForm7Name] = $egoiMailListBuilderContactForm7Value;        }        else if (array_key_exists($egoiMailListBuilderContactForm7Name, $this->egoiMailListBuilderContactForm7OptIn)) {            $this->egoiMailListBuilderContactForm7OptIn[$egoiMailListBuilderContactForm7Name] = $egoiMailListBuilderContactForm7Value;        }		else {			return null;		}    }		public function isAuthed() {		if(			!empty($this->egoiMailListBuilderContactForm7Data['client_id']) && 			isset($this->egoiMailListBuilderContactForm7Data['client_id']) && 			!empty($this->egoiMailListBuilderContactForm7Data['api_key']))		{			return true;		}		else		{			return false;		}	}		public function getClient() {		$params = array(			'plugin_key' => EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_PLUGIN_KEY,			'apikey' => $this->egoiMailListBuilderContactForm7Data['api_key']		);		$result = $this->connectXmlrpc('getClientData',$params);		if(is_string($result)){			if(array_key_exists((string)$result,$this->egoiMailListBuilderContactForm7ErrorCodes)) {					$this->egoiMailListBuilderContactForm7Error['exists'] = true;					$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result;					$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result];			}		}		else {			return $result;		}	}		public function getLists() {		$params = array(			'plugin_key' => EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_PLUGIN_KEY,			'apikey' => $this->egoiMailListBuilderContactForm7Data['api_key']		);		$result = $this->connectXmlrpc('getLists',$params);		if(is_string($result)){			if(array_key_exists((string)$result,$this->egoiMailListBuilderContactForm7ErrorCodes)) {				$this->egoiMailListBuilderContactForm7Error['exists'] = true;				$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result;				$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result];			}		}		else if(is_array($result)){			if(isset($result["ERROR"])){				if(array_key_exists((string)$result["ERROR"],$this->egoiMailListBuilderContactForm7ErrorCodes)) {					$this->egoiMailListBuilderContactForm7Error['exists'] = true;					$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result["ERROR"];					$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result["ERROR"]];				}			}			else {				return $result;			}		}	}		public function createList($nome = '', $idioma_lista = '') {		$params = array(			'plugin_key' => EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_PLUGIN_KEY,			'apikey' => $this->egoiMailListBuilderContactForm7Data['api_key'],			'nome' => $nome,			'idioma_lista' => $idioma_lista,			'canal_email' => '1',			'canal_sms' => '0',			'canal_fax' => '0',			'canal_voz' => '0',			'canal_mms' => '0'		);		$result = $this->connectXmlrpc('createList',$params);		if(is_string($result)){			if(array_key_exists((string)$result,$this->egoiMailListBuilderContactForm7ErrorCodes)) {					$this->egoiMailListBuilderContactForm7Error['exists'] = true;					$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result;					$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result];			}		}		if(is_array($result)){			if(isset($result["ERROR"])){				if(array_key_exists((string)$result["ERROR"],$this->egoiMailListBuilderContactForm7ErrorCodes)) {						$this->egoiMailListBuilderContactForm7Error['exists'] = true;						$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result["ERROR"];						$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result["ERROR"]];				}			}		}	}		public function updateList($listID = '',$name = '', $idioma_lista = '') {		$params = array(			'plugin_key' => EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_PLUGIN_KEY,			'apikey' => $this->egoiMailListBuilderContactForm7Data['api_key'],			'listID' => $listID,			'name' => $name,			'language' => $idioma_lista		);		//$params = php_xmlrpc_encode($params);		$result = $this->connectXmlrpc('updateList',$params);		if(is_string($result)){			if(isset($result["ERROR"])){				if(array_key_exists((string)$result,$this->egoiMailListBuilderContactForm7ErrorCodes)) {						$this->egoiMailListBuilderContactForm7Error['exists'] = true;						$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result;						$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result];				}			}		}	}		public function addSubscriber($listID = '', $first_name = '', $last_name = '', $email = '', $cellphone = '', $lang = '', $birth_date = '') {		$params = array(			'plugin_key' => EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_PLUGIN_KEY,			'apikey' => $this->egoiMailListBuilderContactForm7Data['api_key'],			'status' => $this->egoiMailListBuilderContactForm7OptIn['double_opt_in'],			'listID' => $listID,			'first_name' => $first_name,			'last_name' => $last_name,			'email' => $email,			'cellphone' => $cellphone,			'lang' => $lang,			'birth_date' => $birth_date		);		$result = $this->connectXmlrpc('addSubscriber',$params);				if(is_string($result)){			if(array_key_exists((string)$result,$this->egoiMailListBuilderContactForm7ErrorCodes)) {				/*$this->egoiMailListBuilderContactForm7Error['exists'] = true;				$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result;				$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result];*/				return $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result];			}		}		if(is_array($result)){			if(isset($result["ERROR"])){				if(array_key_exists((string)$result["ERROR"],$this->egoiMailListBuilderContactForm7ErrorCodes)) {					/*$this->egoiMailListBuilderContactForm7Error['exists'] = true;					$this->egoiMailListBuilderContactForm7Error['error'] = (string)$result["ERROR"];					$this->egoiMailListBuilderContactForm7Error['description'] = $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result["ERROR"]];*/					return $this->egoiMailListBuilderContactForm7ErrorCodes[(string)$result["ERROR"]];				}			}		}			}	public function checkSubscriber($listID, $subscriber){		$params = array(			'plugin_key' => EGOI_MAIL_LIST_BUILDER_CONTACT_FORM_7_PLUGIN_KEY,			'apikey' => $this->egoiMailListBuilderContactForm7Data['api_key'],			'listID' => $listID,			'subscriber' => $subscriber		);		$result = $this->connectXmlrpc('subscriberData',$params);		if(is_array($result)){			if(isset($result['ERROR'])){				if(array_key_exists($result['ERROR'],$this->egoiMailListBuilderContactForm7ErrorCodes)) {					return -1;				}			}			else{				return $result['subscriber']['STATUS'];			}		}	}}?>